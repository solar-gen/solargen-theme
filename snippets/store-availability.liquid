{%- assign pick_up_availabilities = product_variant.store_availabilities | where: 'pick_up_enabled', true -%}

<div class="sg-pickup-container" data-section-id="{{ section.id }}" data-section-type="store-availability" data-count="{{ pick_up_availabilities.size }}">
  {%- if pick_up_availabilities.size > 0 -%}
    {%- assign closest_location = pick_up_availabilities.first -%}
    
    {%- if closest_location.available -%}
      <div style="margin: 24px 0 16px 0; display: flex; align-items: flex-start; gap: 12px;">
        
        <!-- Ganz grüne Akzentleiste -->
        <div style="width: 2px; background: #10b981; border-radius: 1px; flex-shrink: 0; min-height: 50px;"></div>
        
        <!-- Sehr dezentes Checkmark Icon -->
        <div style="width: 18px; height: 18px; border: 1px solid #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; background: rgba(16, 185, 129, 0.03);">
          <svg width="10" height="8" viewBox="0 0 10 8" fill="none" style="color: #10b981; opacity: 0.8;">
            <path d="M1 4L3.5 6.5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        
        <!-- Content -->
        <div style="flex: 1; padding-left: 4px; padding-top: 1px;">
          <div style="font-size: 14px; color: #374151; line-height: 1.5; margin-bottom: 4px;">
            Abholung in Saarlouis / Bous möglich • In der Regel abholbereit in 2-4 Werktagen
          </div>
          <button type="button" data-action="open-modal" aria-controls="StoreAvailabilityModal-{{ product_variant.id }}" style="background: none; border: none; color: #3b82f6; text-decoration: underline; font-size: 13px; padding: 0; cursor: pointer; font-weight: 500;">
            Shop-Informationen anzeigen
          </button>
        </div>
      </div>
    {%- else -%}
      <div class="sg-pickup-info sg-pickup-info--unavailable">
        <div class="sg-pickup-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </div>
        
        <div class="sg-pickup-content">
          <div class="sg-pickup-title">Abholung in Saarlouis / Bous derzeit nicht möglich</div>
          {%- if pick_up_availabilities.size > 1 -%}
            <button type="button" class="sg-pickup-link" data-action="open-modal" aria-controls="StoreAvailabilityModal-{{ product_variant.id }}">
              Andere Standorte prüfen
            </button>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}

    <dialog class="store-availabilities-modal modal" tabindex="-1" id="StoreAvailabilityModal-{{ product_variant.id }}">
      <div class="modal__dialog" role="dialog">
        <div class="store-availabilities-modal__header modal__header modal__header--bordered">
          <div class="store-availabilities-modal__product-information">
            <h2 class="store-availabilities-modal__product-title modal__title heading h3">{{ product_variant.product.title }}</h2>

            {%- if product_variant.title != 'Default Title' -%}
              <p class="store-availabilities-modal__variant-title">{{ product_variant.title }}</p>
            {%- endif -%}
          </div>

          <button type="button" class="store-availabilities-modal__close modal__close link" data-action="close-modal" title="{{ 'general.accessibility.close' | t | escape }}">
            {%- render 'icon', icon: 'close' -%}
          </button>
        </div>

        <div class="store-availabilities-list modal__content">
          {%- for availability in pick_up_availabilities -%}
            <div class="store-availability-list__item">
              <p class="store-availability-list__location text--strong">{{ availability.location.name }}</p>

              <div class="store-availability-list__item-info">
                <div class="store-availability-list__stock">
                  {%- if availability.available -%}
                    {%- render 'icon', icon: 'store-availability-in-stock' -%} {{ 'store_availability.general.pick_up_available' | t }}, {{ availability.pick_up_time | downcase }}
                  {%- else -%}
                    {%- render 'icon', icon: 'store-availability-out-of-stock' -%} {{ 'store_availability.general.pick_up_currently_unavailable' | t }}
                  {%- endif -%}
                </div>

                <div class="store-availability-list__contact">
                  {%- assign address = availability.location.address -%}
                  {{- address | format_address -}}

                  {%- if address.phone.size > 0 -%}
                    {{ address.phone }}
                  {%- endif -%}
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
      </div>
    </dialog>
  {%- endif -%}
</div>